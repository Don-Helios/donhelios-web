<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  <meta name="referrer" content="origin">
</head>
<body>
  <!-- Debug panel -->
  <div id="debug-info" style="position: fixed; top: 10px; right: 10px; background: #f0f0f0; padding: 10px; font-size: 12px; border: 1px solid #ccc; z-index: 9999; max-width: 300px;">
    <div>Loading Decap CMS...</div>
    <div id="storage-test"></div>
    <div id="https-test"></div>
    <div id="cms-status"></div>
  </div>

  <script>
    // Test storage availability
    function testStorage() {
      const debugEl = document.getElementById('storage-test');
      try {
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        debugEl.innerHTML += '<div style="color: green;">✓ localStorage available</div>';
        return true;
      } catch (e) {
        debugEl.innerHTML += '<div style="color: red;">✗ localStorage blocked: ' + e.message + '</div>';
        return false;
      }
    }

    // Test HTTPS
    function testHTTPS() {
      const debugEl = document.getElementById('https-test');
      if (location.protocol === 'https:') {
        debugEl.innerHTML += '<div style="color: green;">✓ HTTPS enabled</div>';
        return true;
      } else {
        debugEl.innerHTML += '<div style="color: red;">✗ HTTP detected (HTTPS required)</div>';
        return false;
      }
    }

    // Run tests
    const storageOK = testStorage();
    const httpsOK = testHTTPS();
    
    if (!httpsOK) {
      document.body.innerHTML = '<div style="padding: 20px; background: #ffebee; border: 1px solid #f44336; margin: 20px;"><h2>HTTPS Required</h2><p>Decap CMS requires HTTPS to function properly. Please access this page via <strong>https://</strong> instead of http://</p><p>Try: <a href="https://donhelios.com/admin/">https://donhelios.com/admin/</a></p></div>';
    } else if (!storageOK) {
      document.body.innerHTML = '<div style="padding: 20px; background: #fff3e0; border: 1px solid #ff9800; margin: 20px;"><h2>Browser Storage Blocked</h2><p>Your browser is blocking localStorage access. This can happen in:</p><ul><li>Private/Incognito mode</li><li>Some browser security settings</li><li>Certain extensions</li></ul><p>Please try:</p><ul><li>Regular browser window (not incognito)</li><li>Different browser</li><li>Check browser privacy settings</li></ul></div>';
    } else {
      // Storage works, load CMS
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/decap-cms@^3.2.7/dist/decap-cms.js';
      script.onload = function() {
        document.getElementById('cms-status').innerHTML = '<div style="color: green;">✓ Decap CMS loaded</div>';
        
        // Hide debug panel after 5 seconds if CMS loads successfully
        setTimeout(() => {
          const debugPanel = document.getElementById('debug-info');
          if (debugPanel) {
            debugPanel.style.display = 'none';
          }
        }, 5000);
      };
      script.onerror = function() {
        document.getElementById('cms-status').innerHTML = '<div style="color: red;">✗ Failed to load Decap CMS</div>';
      };
      document.head.appendChild(script);
    }
  </script>
</body>
</html>
